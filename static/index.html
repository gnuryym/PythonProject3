<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Профиль пользователя</title>
</head>
<body>
<h2 id="uname"></h2>
<p id="urole"></p>
<p id="uportfolio"></p>
<button id="favBtn">В избранное</button>
<button id="msgBtn">Написать сообщение</button>

<script>
let currentUser = null; // текущий вошедший пользователь
let profileUserId = null;
let profileName = null;

// Получаем id пользователя из URL
profileUserId = parseInt(window.location.pathname.split("/").pop());

async function loadProfile(){
  try{
    let res = await fetch('/profile/'+profileUserId);
    let data = await res.json();
    document.getElementById('uname').innerText = data.name;
    document.getElementById('urole').innerText = data.role;
    document.getElementById('uportfolio').innerText = data.portfolio || 'Портфолио пусто';
    profileName = data.name;
  }catch(e){ console.error(e); }
}

// Кнопка "В избранное"
document.getElementById('favBtn').onclick = async function(){
  try{
    await fetch('/fav',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({user: currentUser.id, fav: profileUserId})
    });
    alert('Добавлено в избранное');
  } catch(e){ console.error(e); }
};

// Кнопка "Написать сообщение"
document.getElementById('msgBtn').onclick = function(){
  openChat(profileUserId, profileName); // используем существующую функцию
}

loadProfile();
</script>
</body>
</html>
