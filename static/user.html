<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Профиль пользователя</title>
<style>
body{font-family:Arial,sans-serif;margin:5px}
button{margin:5px;padding:5px;font-size:16px;cursor:pointer}
</style>
</head>
<body>

<h2 id="userName"></h2>
<p id="userRole"></p>
<p id="userPortfolio"></p>

<button id="favBtn"></button>
<button id="chatBtn">Написать сообщение</button>
<button id="mainBtn">В главную</button>

<script>
let loggedUser = null;      // залогиненный
let profileUser = null;     // чей профиль открыт

function getUserIdFromURL() {
    let parts = window.location.pathname.split('/');
    return parseInt(parts[parts.length-1]);
}

async function loadProfile() {
    let uid = getUserIdFromURL();
    try {
        let res = await fetch('/users');
        let users = await res.json();
        profileUser = users.find(u => u.id === uid);

        loggedUser = JSON.parse(localStorage.getItem('loggedUser'));

        userName.innerText = profileUser.name;
        userRole.innerText = profileUser.role;
        userPortfolio.innerText = profileUser.portfolio || "Портфолио отсутствует";

        favBtn.innerText = (loggedUser.fav||[]).includes(profileUser.id)?'Удалить из избранного':'В избранное';
        favBtn.onclick = async () => {
            await fetch('/fav', {
                method:'POST',
                headers:{'Content-Type':'application/json'},
                body: JSON.stringify({user: loggedUser.id, fav: profileUser.id})
            });
            window.location.href = '/#fav';
        }

        chatBtn.onclick = () => {
            localStorage.setItem('chatTo', profileUser.id);
            window.location.href = '/#chat';
        }

        mainBtn.onclick = () => {
            window.location.href = '/';
        }

    } catch(e) {
        console.error(e);
    }
}

loadProfile();
</script>
</body>
</html>
